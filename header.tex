
%%% PACKAGES
%%%------------------------------------------------------------------------------

\usepackage[utf8x]{inputenc} % If utf8 encoding
% \usepackage[lantin1]{inputenc} % If not utf8 encoding, then this is probably the way to go
\usepackage[T1]{fontenc}    %
\usepackage[round]{natbib}
% \usepackage{backref}
\usepackage[french,english]{babel} % English please
\usepackage[final]{microtype} % Less badboxes
\usepackage{siunitx}

\usepackage{geometry}

% \usepackage{kpfonts} %Font

% Palatino
%\usepackage{newpxtext,newpxmath}

\usepackage{lmodern}


%\usepackage{newtxmath}

\usepackage{amssymb}
\usepackage{amsmath,amssymb,mathtools,amsthm} % Math
\usepackage{dsfont}
%\renewcommand{\theta}{\uptheta}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\usepackage{changepage}

\usepackage{afterpage}
\usepackage{paralist}

\usepackage{graphicx} % Include figures
\usepackage{multirow}
\usepackage{multicol}
\usepackage{wrapfig}
\usepackage{numprint}
\usepackage{subcaption}
\let\subcaption\relax
\let\subfloat\relax


\usepackage[table]{xcolor}
\usepackage{pgfplots}
\usepackage{tikz,tkz-euclide}
\usepackage{tikz-3dplot}
\usepackage[edges]{forest}

\definecolor{foldercolor}{RGB}{124,166,198}
\usepackage[most]{tcolorbox}
\usetikzlibrary{shapes.multipart,calc}
\usetikzlibrary{decorations.markings}
\usepackage{varwidth}
\definecolor{formalshade}{rgb}{0.95,0.95,1}
\definecolor{darkblue}{rgb}{0.0, 0.0, 0.55}
% \tcbuselibrary{breakable}
\newtcolorbox{eqbox}[1][]
{
colback=gray!10,
boxrule=0pt,
title={#1},
}


\tikzset{pics/folder/.style={code={%
    \node[inner sep=0pt, minimum size=#1](-foldericon){};
    \node[folder style, inner sep=0pt, minimum width=0.3*#1, minimum height=0.6*#1, above right, xshift=0.1*#1] at (-foldericon.west){};
    \node[folder style, inner sep=0pt, minimum size=#1] at (-foldericon.center){};}
    },
    pics/folder/.default={20pt},
    folder style/.style={draw=foldercolor!80!black,top color=foldercolor!40,bottom color=foldercolor}
}

\forestset{is file/.style={edge path'/.expanded={%
        ([xshift=\forestregister{folder indent}]!u.parent anchor) |- (.child anchor)},
        inner sep=1pt},
    this folder size/.style={edge path'/.expanded={%
        ([xshift=\forestregister{folder indent}]!u.parent anchor) |- (.child anchor) pic[solid]{folder=#1}}, inner ysep=0.6*#1},
    folder tree indent/.style={before computing xy={l=#1}},
    folder icons/.style={folder, this folder size=#1, folder tree indent=3*#1},
    folder icons/.default={12pt},
}
\newenvironment{constructionbox}[1][]{
    \begin{eqbox}[#1]
 }{
   \end{eqbox}
}

\usepackage[explicit]{titlesec}
\titlespacing{\paragraph}{0pt}{0pt}{.5em}[]

\usetikzlibrary{matrix}
\usetikzlibrary{snakes,arrows,shapes,shapes.misc,arrows.meta}
\usetikzlibrary{decorations.pathreplacing}

\usetikzlibrary{shapes.geometric}
\usetikzlibrary{decorations.markings}
\newcommand{\tl}[2]{\begin{tabular}{c} #1 \\ #2 \end{tabular} }
\definecolor{lightgray}{gray}{.95}

\usetikzlibrary{intersections, decorations.pathmorphing}

\usepackage[outline]{contour}


%\usepgfplotslibrary{external}
%\tikzexternalize
\usetikzlibrary{matrix}
\usepgfplotslibrary{patchplots}

\pgfplotsset{compat=1.11}
\tikzset{>=stealth}

\usepgfplotslibrary{external}
\tikzexternalize[prefix=tikz/]


\usepackage{minted}
\setminted{fontsize=\small}


\usepackage{enumitem}

\usepackage{minitoc}
\dominitoc

\usepackage{import}
\usepackage{xstring}	%\StrSubstitutees
\usepackage{ifthen}

\usepackage{bibentry}

\renewcommand{\cite}[2][]{\citep[#1]{#2}}

\usepackage{pdfpages}
\usepackage{algorithm,setspace}
\usepackage[noend]{algorithmic}
% \usepackage{algorithm}
% % \usepackage{algpseudocode}
% \renewcommand{\algorithmicrequire}{\textbf{Input:}}
% \renewcommand{\algorithmicensure}{\textbf{Output:}}

% \usepackage[noend]{algpseudocode}
% \algtext*{EndFor}% Remove "end while" text
% \algtext*{EndWhile}% Remove "end while" text
% \algtext*{EndIf}% Remove "end if" text
% \algtext*{EndFunction}% Remove "end if" text

% \algrenewcommand\textproc{}% Used to be \textsc
% \algnewcommand{\LeftComment}[1]{\Statex \(\triangleright\) #1}


% \makeatletter
% \newcommand{\algrule}[1][.2pt]{\par\vskip.5\baselineskip\hrule height #1\par\vskip.5\baselineskip}
% \makeatother

% \newcommand\StateX{\Statex\hspace{\algorithmicindent}}
% \newcommand\StateXX{\Statex\hspace{\algorithmicindent}\hspace{\algorithmicindent}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Chapter abstracts
\newcommand*\bigcdot{\mathpalette\bigcdot@{.75}}
\newcommand*\bigcdot@[2]{\mathbin{\vcenter{\hbox{\scalebox{#2}{$\m@th#1\bullet$}}}}}

\usepackage{environ}

\NewEnviron{keypoints}[1]{
  \setlength{\fboxrule}{0pt}
  \fboxsep=20pt
  \vspace{-3cm}
  \noindent\fcolorbox{gray!10}{gray!10}{%
      \parbox{\textwidth}{%

    \BODY
    }%
  }

  \newpage
  \mtcsetoffset{minitoc}{-2.0em}
  \renewcommand{\mtctitle}{Chapter \thechapter{} -- #1:}
  \minitoc

}{}



\NewEnviron{keypointsmargin}[2]{
  \setlength{\fboxrule}{0pt}
  \fboxsep=20pt
  \vspace{-3cm}
  \noindent\fcolorbox{gray!10}{gray!10}{%
      \parbox{\textwidth}{%

    \BODY
    }%
  }

  \newpage
  \vspace*{#2}
  \mtcsetoffset{minitoc}{-2.0em}
  \renewcommand{\mtctitle}{Chapter \thechapter{} -- #1:}
  \minitoc

}{}



\NewEnviron{keypointstwomargins}[3]{
  \vspace{#2}
  \begin{center}
  \noindent\begin{tcolorbox}[width=\linewidth, halign=center, colframe=black, colback=gray!30, boxsep=5mm, arc=3mm]
    \BODY
  \end{tcolorbox}
  \end{center}
  \newpage
  \vspace*{#3}
  \mtcsetoffset{minitoc}{-2.0em}
  \renewcommand{\mtctitle}{Chapter \thechapter{} -- #1:}
  \minitoc

}{}


\newenvironment{myepigraph}
  {\par\hfill\itshape
   \begin{tabular}{@{}r@{\hspace{2em}}}} % 2em from the right margin
  {\end{tabular}\par\medskip}
%%% PAGE LAYOUT
%%%------------------------------------------------------------------------------

\setlrmarginsandblock{0.15\paperwidth}{*}{1} % Left and right margin
\setulmarginsandblock{0.2\paperwidth}{*}{1}  % Upper and lower margin
\checkandfixthelayout

%%% SECTIONAL DIVISIONS
%%%------------------------------------------------------------------------------

\maxsecnumdepth{subsection} % Subsections (and higher) are numbered
\setsecnumdepth{subsection}

\makeatletter %
\makechapterstyle{standard}{
  \setlength{\beforechapskip}{0\baselineskip}
  \setlength{\midchapskip}{1\baselineskip}
  \setlength{\afterchapskip}{8\baselineskip}
  \renewcommand{\chapterheadstart}{\vspace*{\beforechapskip}}
  \renewcommand{\chapnamefont}{\centering\normalfont\Large}
  \renewcommand{\printchaptername}{\chapnamefont \@chapapp}
  \renewcommand{\chapternamenum}{\space}
  \renewcommand{\chapnumfont}{\normalfont\Large}
  \renewcommand{\printchapternum}{\chapnumfont \thechapter}
  \renewcommand{\afterchapternum}{\par\nobreak\vskip \midchapskip}
  \renewcommand{\printchapternonum}{\vspace*{\midchapskip}\vspace*{5mm}}
  \renewcommand{\chaptitlefont}{\centering\bfseries\LARGE}
  \renewcommand{\printchaptertitle}[1]{\chaptitlefont ##1}
  \renewcommand{\afterchaptertitle}{\par\nobreak\vskip \afterchapskip}
}
\makeatother

\chapterstyle{standard}
%\chapterstyle{dowding}


\setsecheadstyle{\normalfont\large\bfseries}
\setsubsecheadstyle{\normalfont\normalsize\bfseries}
\setparaheadstyle{\normalfont\normalsize\bfseries}
\setparaindent{0pt}\setafterparaskip{0pt}

%%% FLOATS AND CAPTIONS
%%%------------------------------------------------------------------------------

\makeatletter                  % You do not need to write [htpb] all the time
\renewcommand\fps@figure{htbp} %
\renewcommand\fps@table{htbp}  %
\makeatother                   %

\captiondelim{\space } % A space between caption name and text
\captionnamefont{\small\bfseries} % Font of the caption name
\captiontitlefont{\small\normalfont} % Font of the caption text

\changecaptionwidth          % Change the width of the caption
% \captionwidth{\textwidth} %

%%% ABSTRACT
%%%------------------------------------------------------------------------------

\renewcommand{\abstractnamefont}{\normalfont\small\bfseries} % Font of abstract title
\setlength{\absleftindent}{0.1\textwidth} % Width of abstract
\setlength{\absrightindent}{\absleftindent}

%%% HEADER AND FOOTER
%%%------------------------------------------------------------------------------

\makepagestyle{standard} % Make standard pagestyle

\makeatletter                 % Define standard pagestyle
\makeevenfoot{standard}{}{}{} %
\makeoddfoot{standard}{}{}{}  %
\makeevenhead{standard}{\bfseries\thepage\normalfont\qquad\small\leftmark}{}{}
\makeoddhead{standard}{}{}{\small\rightmark\qquad\bfseries\thepage}
% \makeheadrule{standard}{\textwidth}{\normalrulethickness}
\makeatother                  %

\makeatletter
\makepsmarks{standard}{
\createmark{chapter}{both}{shownumber}{\@chapapp\ }{ \quad }
\createmark{section}{right}{shownumber}{}{ \quad }
\createplainmark{toc}{both}{\contentsname}
\createplainmark{lof}{both}{\listfigurename}
\createplainmark{lot}{both}{\listtablename}
\createplainmark{bib}{both}{\bibname}
\createplainmark{index}{both}{\indexname}
\createplainmark{glossary}{both}{\glossaryname}
}
\makeatother                               %

\makepagestyle{chap} % Make new chapter pagestyle

\makeatletter
\makeevenfoot{chap}{}{\small\bfseries\thepage}{} % Define new chapter pagestyle
\makeoddfoot{chap}{}{\small\bfseries\thepage}{}  %
\makeevenhead{chap}{}{}{}   %
\makeoddhead{chap}{}{}{}    %
% \makeheadrule{chap}{\textwidth}{\normalrulethickness}
\makeatother

\nouppercaseheads
\pagestyle{standard}               % Choosing pagestyle and chapter pagestyle
\aliaspagestyle{chapter}{chap} %

%%% NEW COMMANDS
%%%------------------------------------------------------------------------------

\newcommand{\p}{\partial} %Partial
% Or what ever you want

%%% TABLE OF CONTENTS
%%%------------------------------------------------------------------------------

% \maxtocdepth{subsection} % Only parts, chapters and sections in the table of contents
% \settocdepth{subsection}

\AtEndDocument{\addtocontents{toc}{\par}} % Add a \par to the end of the TOC

%%% INTERNAL HYPERLINKS
%%%-------------------------------------------------------------------------------

\PassOptionsToPackage{hyphens}{url}
\usepackage[pagebackref=true]{hyperref}   % Internal hyperlinks
\hypersetup{
% pdfborder={0 0 0},      % No borders around internal hyperlinks
pdfauthor={Tanguy Lefort}  % author
}
\usepackage{memhfixc}   %
\usepackage{cleveref}
\renewcommand*{\backrefalt}[4]{%
\ifcase #1 %
No citations.%
\or
(cit. on p. #2).%
\else
(cit. on pp. #2).%
\fi
}
%%% -----------------------------------------------------------------------------------
% chapters titlepage
% \usepackage{kpfonts}
\setSingleSpace{1.1}
\SingleSpacing
\usepackage{xcolor,calc, blindtext}
\definecolor{chaptercolor}{gray}{0.8}
% helper macros
\newcommand\numlifter[1]{\raisebox{-2cm}[0pt][0pt]{\smash{#1}}}
\newcommand\numindent{\kern37pt}
\newlength\chaptertitleboxheight
\makechapterstyle{hansen}{
  \renewcommand\printchaptername{\raggedleft}
  \renewcommand\printchapternum{%
    \begingroup%
    \leavevmode%
    \chapnumfont%
    \strut%
    \numlifter{\thechapter}%
    \numindent%
\endgroup%
}
  \renewcommand*{\printchapternonum}{%
    \vphantom{\begingroup%
      \leavevmode%
      \chapnumfont%
      \numlifter{\vphantom{9}}%
      \numindent%
      \endgroup}
    \afterchapternum}
  \setlength\midchapskip{0pt}
  \setlength\beforechapskip{0.5\baselineskip}
  \setlength{\afterchapskip}{3\baselineskip}
  \renewcommand\chapnumfont{%
    \fontsize{4cm}{0cm}%
    \bfseries%
    \sffamily%
    \color{chaptercolor}%
  }
  \renewcommand\chaptitlefont{%
    \normalfont%
    \huge%
    \bfseries%
    \raggedleft%
  }%
  \settototalheight\chaptertitleboxheight{%
    \parbox{\textwidth}{\chaptitlefont \strut bg\\bg\strut}}
  \renewcommand\printchaptertitle[1]{%
    \parbox[t][\chaptertitleboxheight][t]{\textwidth}{%
      %\microtypesetup{protrusion=false}% add this if you use microtype
      \chaptitlefont\strut ##1\strut}%
      \vspace{2pt}
}}
\chapterstyle{hansen}
\aliaspagestyle{chapter}{empty} % just to save some space

%%%%%%
\newcommand{\AUM}{\mathrm{AUM}}
\newcommand{\WAUM}{\mathrm{WAUM}}

% \usepackage{multirow} % For multirow cells
% \usepackage{hhline} % For better horizontal lines
% \usepackage{makecell} % For cell alignment